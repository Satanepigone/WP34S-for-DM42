<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>WP-34s for DM42</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=VT323">
    <style>
      body{font-family: sans-serif;}
      h1 {font-weight: bold; color: #000000;}
      a {font-weight: bold; }
      td {vertical-align: top;}
      .button {background: #444444;color: #FFFFFF;font-family: monospace;padding: 1px;}
      .lcd {background: #CCCCCC;font-family: VT323, monospace;font-size: 18px; }
    </style>
  </head>
  <body>
    <h1>WP-34s for DM42</h1>
    <br>
    <h3>Navigation</h3>
    Press <span class="button">+</span> to move one line forward<br>
    Press <span class="button">-</span> to move one line backward<br>
    Press <span class="button">&times;</span> to move one page forward<br>
    Press <span class="button">&divide;</span> to move one page backward<br>
    <br>


    <h3>Symbols used in this guide</h3>
    A <span class="lcd">123</span> represents a soft button or anything on the LCD<br>
    A <span class="button">STO</span> represents a physical button<br>
    <br>
    <h2 id="Home">Contents</h2>
    <ul>
      <li><a href="#escape">How to get out of the program!</a></li>
      <li><a href="#intro">Introduction</a></li>
      <li><a href="#basics">Basics</a></li>
      <li><a href="#menus">Menus</a></li>
      <li><a href="#cats">Catalogues</a></li>
      <li><a href="#unshift">Unshifted keys</a></li>
      <li><a href="#fshift">f-shifted keys</a></li>
      <li><a href="#gshift">g-shifted keys</a></li>
      <li><a href="#alpha">Alpha mode</a></li>
      <li><a href="#files">Working with files</a></li>
    </ul>
    <br><br>

    <h2 id="intro">Introduction</h2>
    
    The WP-34s calculator was born when someone at HP provided a
    development kit and programming cables to allow the firmware of the
    HP-20b and 30b calculators to be re-flashed.
    <br>
    This led to the
    development of an open-source RPN programmable scientific
    calculator, the WP-34s. Despite the limits of the target
    hardware - for example, just 2k of RAM and a very limited display -
    the result was extraordinary.
    <br>
    With a programming cable, key stickers
    and an overlay, these business calculators could become what is, in
    many ways, one of the most powerful RPN calculators ever.
    <br>
    The 20b and 30b calculators are no longer produced, but the WP-34s
    lives on, with versions for desktops, iOS and Android. The aim of this
    project is to bring the WP-34s to the hardware of the
    DM42.
    <br>
    Changing a business calculator to an RPN scientific might be seen as
    an upgrade,
    but why replace the already-excellent Free42 on the DM42 with the
    WP-34s?
    <br>
    One point to remember is that the change can be reversed, as 
    many times as you like.
    <br>
    Also, compared to Free42 the WP34s has a far greater
    number of built-in functions, especially conversions and
    statistics. It's fun, too!
    <br>
    The WP-34s on the DM42 still only offers 2k of RAM to the user and the
    display matches the original, so it is not an upgrade.
    <br>
    A project that does aim to make full use of the DM42 hardware is the WP-43s,
    which (as its name suggests) is like the WP-34s, but 9 bigger. Although
    its keyboard layout doesn't match the DM42 keyboard there
    is a version (the WP-43C, or C43) which does.
    <br>
    As yet this is
    incomplete (though usable), but if you need more than the WP-34s or Free42 can offer
    you shouldn't have long to wait.
    <br>

    <h2 id="basics">Basics</h2>

    WP-34s for the DM42 matches the original closely. It
    lacks printing, stopwatch, and serial functions,
    but it does have an extended set of <a href="#files">file functions</a>. 
    <br>
    <h3>Shifts</h3>
    The WP-34s uses three shift keys; the DM42 keyboard has just one. So
    <b>menus</b> are used to fit the full set of WP-34s keyboard functions onto
    the DM42 keyboard.
    <br>
    Outside of alpha mode there are two shift states, f (one press of
    <span class="lcd">SHIFT</span>) and g (two presses). A third press cancels the shift.
    <br>
    In this manual, <span class="button">SHIFT</span> will be shown
    as <span class="button">f</span>
    and <span class="button">SHIFT</span> <span class="button">SHIFT</span>
    as <span class="button">g</span>.
    <br>
    <span id="escape"><b>IMPORTANT</b></span>: To get back to the DMCP menu
    (e.g., in order to reload the 
    Free42 firmware):
    <ul>
      <li>Press <span class="button">SHIFT</span> <span class="button">0</span>. This brings up the SETUP menu.</li>
      <li>Press <span class="button">F1</span> (System), followed by
	<span class="button">1</span>, <span class="button">2</span>,
	<span class="button">4</span>.</li>
      <li>You can then use <span class="lcd">3: Load Program</span> to choose a
	different firmware file to load, or <span class="lcd">2: Run Program</span>
	to return to the already-loaded WP-34s.</li>
    </ul>
    <br>

    <h2 id="menus">Menus</h2>
    Menus use the top row of function keys, unshifted and f-shifted, to
    make the full WP-34s keyboard available. All menus have the right-arrow
    and CPX keys on unshifted F5 and F6. Most menus are on f-shifted keys;
    a few are on g-shifted keys.
    <br>
    <ul>
      <li>Calling the same menu twice goes back to the minimal "blank menu",
	with only arrow and CPX keys.</li>
      <li>Pressing SHIFT-Hold-Down-arrow goes to the last menu.</li>
    </ul>
    <br>
    <h3>Menus on f-shifted keys</h3>
    <ul>
      <li><b>Angles</b> menu
	(<span class="button">f</span> <span class="button">MODES</span>):
	angle modes, H.MS / H.d, co-ordinate 
	conversions and hyperbolic prefixes. This menu is also available from
	g-shifted <span class="button">SIN</span>, <span class="button">COS</span>,
	<span class="button">TAN</span>.</li>
      <li><b>Display</b> menu
	(<span class="button">f</span> <span class="button">DISP</span>):
	display modes, fraction modes, radix 
	choice, and H.MS / H.d.</li>
      <li><b>Clear</b> menu
	(<span class="button">f</span> <span class="button">CLEAR</span>):
	clear program, clear stats, clear x.</li> 
      <li><b>Integrate</b> menu
	(<span class="button">f</span> <span class="button">INTEGRATE</span>):
	SLV, &int;, SUM, and PROD.</li> 
      <li><b>Stats</b> menu
	(<span class="button">f</span> <span class="button">STATS</span>):
	Xbar, Yhat, s (variance) and r 
	(correlation coefficient), plus a link to the SUMS catalogue.</li>
      <li><b>Base</b> menu
	(<span class="button">f</span> <span class="button">BASE</span>):
	BIN, OCT, DEC, HEX, not, and, or, xor, and RMDR.</li>
      <li><b>Flags</b> menu
	(<span class="button">f</span> <span class="button">FLAGS</span>):
	SF, CF, x=? and x&lt;&gt;? tests.</li> 
      <li><b>Probability</b> menu (<span class="button">f</span>
	<span class="button">PROB</span>): factorial, permutations,
	combinations, random numbers, the normal cdf and its inverse.</li>
      <li><b>Setup</b> menu
	(<span class="button">f</span> <span class="button">SETUP</span>):
	DMCP System menu, Help, save and restore 
	state in "flash" memory, save state to and load state from named file.</li>
      <li><b>Misc.</b> menu
	(<span class="button">f</span>-hold-<span class="button">&#9660;</span>):
	functions that didn't fit anywhere else! Mod x, RND, IPart,
	FPart, 2^x, Log2 x, llel, delta 
	percent.</li>
    </ul>
    <br>
    <h3>Menus on g-shifted keys</h3>
    <ul>
      <li><b>X&lt;&gt;Y</b> menu
	(<span class="button">g</span> <span class="button">x&lt;&gt;?</span>):
	Show<-, Show->, and x<>?. (These are the 
	    three shifted functions on the x<>y key on the real WP-34s.)</li>
      <li><b>Setup 2</b> menu
	(<span class="button">g</span> <span class="button">0</span>):
	More file functions; save library to and 
	load library from named file; save program to and load program from
	named file.</li>
      <li><b>Program</b> function menu (<span class="button">g</span>
	<span class="button">R/S</span>): LBL, RTN, Pause, GTO, DSE, ISG.</li>
    </ul>
    <br>

    <h2 id="cats">Catalogues</h2>
    The WP-34s makes most of its functions available via catalogues. This
    is where to find them. The mnemonic column shows the shifted label
    of each key, which should explain why the catalogue is there.
    <table>
      <tr><td><b>Catalogue</b></td><td><b>Location</b></td><td>Mnemonic</td></tr>
      <tr><td>MATRIX</td>
	<td><span class="button">f</span> <span class="button">MATRIX</span></td>
	<td></td>
      </tr>
      <tr><td>CONV</td>
	<td><span class="button">f</span> <span class="button">CONVERT</span></td>
	<td></td>
      </tr>
      <tr><td>P.FCN</td>
	<td><span class="button">f</span> <span class="button">PGM.FCN</span></td>
	<td></td>
      </tr>
      <tr><td>CAT</td>
	<td><span class="button">f</span> <span class="button">CATALOG</span></td>
	<td></td>
      </tr>
      <tr><td>MODE</td>
	<td><span class="button">g</span> <span class="button">+/-</span></td>
	<td><span class="button">MODES</span></td>
      </tr>
      <tr><td>SUMS</td>
	<td><span class="button">g</span> <span class="button">9</span></td>
	<td><span class="button">MATRIX</span></td>
      </tr>
      <tr><td>STAT</td>
	<td><span class="button">g</span> <span class="button">&divide;</span></td>
	<td><span class="button">STAT</span></td>
      </tr>
      <tr><td>CONST</td>
	<td><span class="button">g</span> <span class="button">5</span></td>
	<td><span class="button">CONVERT</span></td>
      </tr>
      <tr><td>TEST</td>
	<td><span class="button">g</span> <span class="button">6</span></td>
	<td><span class="button">FLAGS</span></td>
      </tr>
      <tr><td>PROB</td>
	<td><span class="button">g</span> <span class="button">&times;</span></td>
	<td><span class="button">PROB</span></td>
      </tr>
      <tr><td>X.FCN</td>
	<td><span class="button">g</span> <span class="button">3</span></td>
	<td><span class="button">PGM.FCN</span></td>
      </tr>
      <tr><td>STATUS</td>
	<td><span class="button">g</span> <span class="button">+</span></td>
	<td><span class="button">CATALOG</span></td>
      </tr>
    </table>

    <br>
    <h2 id="unshift">Unshifted keys</h2>
    These all do much what you would expect given their labels.
    <br>
    The four
    keys <span class="button">&sigma;+</span>;, <span class="button">1/x</span>,
    <span class="button">U+221A&nbsp;x</span>,
    and <span class="button">LOG</span> on the top row run code
    starting from labels
    A, B, C, and D if defined in the current program. The keys'
    normal functions are always available via <span class="button">g</span>.
    <br>
    The Arrow key <span class="button">F5</span> brings up a temporary
    menu. Choosing a base from this menu gives a 
    temporary display of the x-register in that base; choosing an angular
    unit converts from the current angular mode to that unit. Conversion
    to and from HMS is also possible.
    <br>
    <h2 id="fshift">f-shifted keys</h2>

    Like the unshifted keys, these do what their labels say or at least something closely
    related.
    <br>
    <ul>
      <li><span class="button">COMPLEX</span> - same function as the CPX key
	(<span class="button">F6</span>).</li>
      <li><span class="button">LASTx</span> - does RCL L, which is how Last
	X works on the WP-34s.</li> 
      <li><span class="button">MODES</span> - angles menu (including angle modes).</li>
      <li><span class="button">DISP</span> - display format menu.</li>
      <li><span class="button">CLEAR</span> - a small menu of clearing operations.</li>
      <li><span class="button">SOLVER</span> - the solver function, SLV.</li>
      <li><span class="button">&int;f(x)</span> - the INTEGRATE menu.</li>
      <li><span class="button">MATRIX</span> - the MATRIX catalogue.</li>
      <li><span class="button">STAT</span> - the STAT menu.</li>
      <li><span class="button">BASE</span> - the BASE menu.</li>
      <li><span class="button">CONVERT</span> - the CONV catalogue.</li>
      <li><span class="button">FLAGS</span> - the Flags menu.</li>
      <li><span class="button">PROB</span> - the Probability menu.</li>
      <li><span class="button">ASSIGN</span>
	and <span class="button">CUSTOM</span> - no function.</li> 
      <li><span class="button">PGM.FCN</span> - the P.FCN catalogue.</li>
      <li><span class="button">PRINT</span> - no function.</li>
      <li><span class="button">SETUP</span> - Setup menu.</li>
      <li><span class="button">SHOW</span> - Show&larr;, which shows the
	full precision of a number in single-precision mode.</li>
      <li><span class="button">PGRM</span> - toggles programming mode.</li>
      <li><span class="button">CATALOG</span> - the CAT catalogue.</li>
    </ul>
    <br>
    <h2 id="gshift">g-shifted keys</h2>

    Many of these have no function. As with the unshifted keys, these
    do what their keylabels say, or at least something closely
    related.
    <br>
    <ul>
      <li><span class="button">&sigma;+</span>;, <span class="button">1/x</span>,
	<span class="button">U+221A&nbsp;x</span>,
	and <span class="button">LOG</span> - unshifted functions of these
	keys, for use when labels A-D are defined.</li>
      <li><span class="button">RCL</span> - View.</li>
      <li><span class="button">SIN</span>, <span class="button">COS</span>,
	<span class="button">TAN</span> - Angles menu (also available
	from <span class="button">f</span> <span class="button">MODES</span>).</li> 
      <li><span class="button">ENTER</span> - Fill.
      <li><span class="button">X&lt;&gt;Y</span> - the X&lt;&gt;Y
	menu. These are the three functions on this key on the original calculator.</li>
      <li><span class="button">+/-</span> - MODE catalogue (MODES).</li>
      <li><span class="button">9</span> - SUMS catalogue (MATRIX).</li>
      <li><span class="button">&divide;</span> - STAT catalogue (STAT).</li>
      <li><span class="button">5</span> - CONST catalogue (CONVERT).</li>
      <li><span class="button">6</span> - TEST catalogue (FLAGS).</li>
      <li><span class="button">&times;</span> - PROB catalogue (PROB).</li>
      <li><span class="button">3</span> - X.FCN catalogue (P.FCN).</li>
      <li><span class="button">0</span> - Setup 2 menu (SETUP).</li>
      <li><span class="button">R/S</span> - Program function menu (PRGM).</li>
      <li><span class="button">+</span> - STATUS (CATALOGUE).</li>  
    </ul>
    <br>
    <h2 id="alpha">Alpha mode</h2>

    Alpha mode is entered and exited via <span class="button">f</span>
    <span class="button">ENTER</span> (ALPHA).

    The letters to the right of the keys on the DM42 keyboard produce the
    corresponding letters in alpha-mode. (Note the extra characters
    available on the bottom row.) This difference carries over to the
    Greek letters - for example, Greek lambda is accessed from
    the <span class="button">TAN</span> key (L) rather than
    the <span class="button">E</span> key (exponent) (which would be L on the WP-34s).

    I believe that alpha mode works in the same way as on the real
    WP-34s. h-shift (3 presses of the shift key) is used in alpha
    mode. The alpha catalogues are accessed from the same keyboard
    positions and shift states as on the real calculator. You are strongly
    advised to read the manual!

    One difference: to get the "?" character you use
    the <span class="button">R/S</span> key, which 
    has "?" printed next to it. You can get the "!" character
    as <span class="button">g</span> <span class="button">R/S</span>.
    <br>

    <h2 id="files">Working with files</h2>

    The memory of the original WP-34s consisted of 2k of RAM and 128k of
    flashable ROM (flash memory). The firmware filled most of the
    flash. Of the remainder, 2k was used to provide a backup region for the
    RAM and what was left - the library - could hold user programs.
    <br>
    (Note that programs can be run from the library without the
    need to load them into RAM!)
    <br>
    This version of the WP-34s holds the backup region and the library in
    RAM rather than in flash memory. The RAM is permanent unless the battery fails or
    the WP-34s firmware is exited (e.g., to re-load Free42); in
    particular, it persists when the calculator is turned off and on.
    <br>
    To provide storage that survives even when the firmware is exited, the
    contents of RAM and the two flash regions are 
    written to a set of files. These files live in
    wp34s/ which is created automatically if it doesn't exist. 
    <br>
    The files are:
    <br>
    <ul>
      <li><b>wp34s.dat</b> - an image of the calculator's RAM which is updated
	each time the calculator is turned off.</li>
      <li><b>wp34s-backup.dat</b> - in the Setup menu Setup
	(<span class="button">f</span> <span class="button">0</span>) the
	function "<span class="lcd">OnSTO</span>"
	writes a copy of the calculator's state to a backup region in
	memory, and also to this file. (On 
	the original WP-34s pressing "On" and "STO" together had the same
	function.) The function <span class="lcd">OnRCL</span> from the same
	menu restores RAM from the backup.</li>
      <li><b>wp34s-lib.dat</b> - the functions <span class="lcd">PSTO</span>
	and <span class="lcd">PRCL</span> in the P.FCN
	catalogue read and write the current program to and from "flash
	memory". When this happens, this library file is updated too.</li>
    </ul>
    <br>
    When the calculator switched off and on, nothing happens (other
    than wp34s.dat being updated). But when the WP-34s firmware is
    restarted from the DMCP menu the RAM, backup, and library regions are
    reloaded from these three files.
    <br>
    Other commands available in the Setup and Setup 2 menus include:
    <br>
    <ul>
      <li><span class="lcd">SvRAM</span> (Save RAM) - writes a copy of RAM
	to a named file (with a .dat 
	extension).</li>
      <li><span class="lcd">LdRAM</span> (Load RAM) - loads a named file
	(with a .dat extension) into 
	RAM.</li>
      <li><span class="lcd">SvLib</span> (Save Library) - writes a copy of
	the library region to a named file (with a .lib extension).</li> 
      <li><span class="lcd">LdLib</span> (Load Library) - loads a named file
	(with a .lib extension) 
	into the library region.</li>
      <li><span class="lcd">SvCPRG</span> (Save current program) - writes a
	copy of the current program 
	to a named file.</li>
      <li><span class="lcd">LdPRG</span> (Load program) - load a named file
	into the flash region (from 
	where it can be copied to RAM with the PRCL command).</li>
    </ul>
    <br>
    IMPORTANT: The library and program files are not human-readable. They
    contain the opcodes that make up the program or the library, along
    with size and checksum information.
    <br>
    To make them human-readable you
    need to disassemble them with the tremendously-versatile WP-34s
    assembler suite of tools.
    <br>
    If you want the files to be portable to 
    other systems, this is vital: the op-codes in the WP-34s can change when
    the number of commands alters, making the files partially or
    completely unreadable.
    <br>
    Not only are the disassembled files
    human-readable, they can be re-assembled correctly when the op-codes change.
    <br>
    Transferring files as source listings is the
    only reliable way to get them from one WP-34s system to another,
    unless both use the same op-codes.

  </body>
</html>
